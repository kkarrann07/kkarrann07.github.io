<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>karann</title>
  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    body { font-family:'Segoe UI',sans-serif; background:#f0f2f5; color:#333; }
    header { background:#4a90e2; color:#fff; padding:1rem; text-align:center; font-size:1.6rem; }
    section { max-width:900px; margin:2rem auto; background:#fff; border-radius:12px; box-shadow:0 4px 20px rgba(0,0,0,0.1); padding:2rem; }
    h2 { font-size:1.5rem; color:#4a90e2; margin-bottom:1rem; text-align:center; position:relative; }
    h2::after { content:''; position:absolute; bottom:-8px; left:50%; transform:translateX(-50%); width:50px; height:3px; background:#4a90e2; border-radius:2px; }
    p { text-align:center; color:#666; margin-bottom:1.5rem; }
    iframe { width:100%; height:500px; border-radius:8px; border:none; box-shadow:0 4px 12px rgba(0,0,0,0.1); transition:transform .3s; }
    iframe:hover { transform:translateY(-4px); }
    .upload-section { display:flex; justify-content:space-around; flex-wrap:wrap; gap:1rem; margin-bottom:2rem; }
    .upload-btn { position:relative; overflow:hidden; display:inline-block; }
    .upload-btn input { position:absolute; top:0; left:0; width:100%; height:100%; opacity:0; cursor:pointer; }
    .upload-btn span { display:block; background:#4a90e2; color:#fff; padding:0.75rem 1.5rem; border-radius:8px; transition:background .3s; user-select:none; }
    .upload-btn span:hover { background:#357ab8; }
    .ar-container { position:relative; width:640px; height:480px; margin:0 auto; border-radius:12px; overflow:hidden; box-shadow:0 8px 30px rgba(0,0,0,0.2); background:#000; }
    video { position:absolute; top:0; left:0; width:100%; height:100%; object-fit:cover; transform:scaleX(-1); }
    .overlay { position:absolute; pointer-events:none; transform-origin:center center; will-change:transform; }
    /* Modern status bar */
    .status-bar { position:absolute; top:10px; right:10px; background:rgba(0,0,0,0.6); color:#fff; padding:5px 10px; border-radius:20px; font-size:0.9rem; }
  </style>
</head>
<body>
  <header>üëó ChechIT ‚Äì AR Try-On</header>

  <section>
    <h2>üîç AI Fashion Search</h2>
    <p>Explore garments via AI embeddings.</p>
    <iframe src="https://kkarrann07-Fashion.hf.space"></iframe>
  </section>

  <section class="upload-section">
    <label class="upload-btn"><span>üëï Upload Shirt</span><input type="file" id="uploadShirt" accept="image/png"></label>
    <label class="upload-btn"><span>‚åö Upload Watch</span><input type="file" id="uploadWatch" accept="image/png"></label>
    <label class="upload-btn"><span>üï∂ Upload Goggles</span><input type="file" id="uploadGoggles" accept="image/png"></label>
  </section>

  <div class="ar-container">
    <video id="video" autoplay playsinline muted></video>
    <img id="shirtOverlay" class="overlay" style="display:none">
    <img id="watchOverlay" class="overlay" style="display:none">
    <img id="gogglesOverlay" class="overlay" style="display:none">
    <div class="status-bar" id="statusBar">Loading...</div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/pose@0.5/pose.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils@0.3/camera_utils.js"></script>
  <script>
    const video = document.getElementById('video'),
          statusBar = document.getElementById('statusBar'),
          shirtO = document.getElementById('shirtOverlay'),
          watchO = document.getElementById('watchOverlay'),
          gogglesO = document.getElementById('gogglesOverlay');

    // handle uploads
    function setup(id, imgElem){
      document.getElementById(id).addEventListener('change',e=>{
        const f=e.target.files[0]; if(!f)return;
        const r=new FileReader();
        r.onload=ev=>{
          imgElem.src=ev.target.result;
          imgElem.style.display='block';
        };
        r.readAsDataURL(f);
      });
    }
    setup('uploadShirt', shirtO);
    setup('uploadWatch', watchO);
    setup('uploadGoggles', gogglesO);

    // camera
    navigator.mediaDevices.getUserMedia({video:{width:640,height:480}})
      .then(s=>{ video.srcObject=s; statusBar.textContent='Initializing pose‚Ä¶'; });

    let latestPose = null;
    const pose = new Pose({
      locateFile: f=>`https://cdn.jsdelivr.net/npm/@mediapipe/pose@0.5/${f}`
    });
    pose.setOptions({modelComplexity:1,smoothLandmarks:true,minDetectionConfidence:0.5,minTrackingConfidence:0.5});
    pose.onResults(r=>{
      latestPose = r.poseLandmarks;
      statusBar.textContent = 'AR Active';
    });
    new Camera(video,{onFrame:async()=>await pose.send({image:video}),width:640,height:480}).start();

    function update(){
      if(latestPose){
        const w=video.clientWidth, h=video.clientHeight;
        const P=i=>{const p=latestPose[i];return{x:(1-p.x)*w,y:p.y*h,v:p.visibility};};
        const ls=P(11), rs=P(12), lh=P(23), rh=P(24),
              rw=P(16), le=P(2), re=P(5);

        // shirt
        if(shirtO.src && ls.v>0.5 && rs.v>0.5 && lh.v>0.5 && rh.v>0.5){
          const cx=(ls.x+rs.x)/2, cy=(ls.y+rs.y)/2,
                hipY=(lh.y+rh.y)/2,
                H=Math.abs(hipY-cy)*1.8, W=Math.hypot(rs.x-ls.x,rs.y-ls.y)*1.4,
                ang=Math.atan2(rs.y-ls.y,rs.x-ls.x)*180/Math.PI;
          Object.assign(shirtO.style,{
            left:`${cx-W/2}px`, top:`${cy-H/2}px`,
            width:`${W}px`, height:`${H}px`,
            transform:`rotate(${ang}deg)`
          });
        }

        // watch
        if(watchO.src && rw.v>0.5){
          const S=w*0.1;
          Object.assign(watchO.style,{
            left:`${rw.x-S/2}px`, top:`${rw.y-S/2}px`,
            width:`${S}px`, height:`${S}px`,
            transform:'rotate(0deg)'
          });
        }

        // goggles
        if(gogglesO.src && le.v>0.5 && re.v>0.5){
          const cx=(le.x+re.x)/2, cy=(le.y+re.y)/2,
                D=Math.hypot(re.x-le.x,re.y-le.y),
                GW=D*2.2, GH=GW*(gogglesO.naturalHeight/gogglesO.naturalWidth);
          Object.assign(gogglesO.style,{
            left:`${cx-GW/2}px`, top:`${cy-GH/2}px`,
            width:`${GW}px`, height:`${GH}px`,
            transform:'rotate(0deg)'
          });
        }
      }
      requestAnimationFrame(update);
    }
    update();
  </script>
</body>
</html>
