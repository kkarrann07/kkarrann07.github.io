<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>AR Fashion Try-On</title>
  <style>
    body {
      margin: 0;
      font-family: "Poppins", sans-serif;
      background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
      color: #fff;
      display: flex;
      flex-direction: column;
      align-items: center;
      height: 100vh;
      overflow: hidden;
    }
    header {
      text-align: center;
      padding: 20px;
    }
    header h1 {
      font-size: 2em;
      margin: 0;
      color: #ffcc70;
    }
    #controls {
      margin: 10px;
    }
    button, input[type="file"] {
      background: #ff7e5f;
      border: none;
      color: #fff;
      padding: 10px 16px;
      margin: 5px;
      border-radius: 8px;
      cursor: pointer;
      transition: background 0.3s;
      font-weight: bold;
    }
    button:hover, input[type="file"]:hover {
      background: #feb47b;
    }
    #videoCanvas {
      border-radius: 12px;
      box-shadow: 0 0 20px rgba(0,0,0,0.5);
    }
  </style>
</head>
<body>
  <header>
    <h1>âœ¨ AR Fashion Try-On</h1>
  </header>

  <div id="controls">
    <input type="file" id="shirtUpload" accept="image/*">
    <input type="file" id="watchUpload" accept="image/*">
    <input type="file" id="gogglesUpload" accept="image/*">
    <button id="screenshotBtn">ðŸ“¸ Screenshot</button>
  </div>

  <canvas id="videoCanvas" width="640" height="480"></canvas>

  <!-- TensorFlow.js + Pose Detection -->
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.21.0/dist/tf.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/pose-detection"></script>

  <script>
    const canvas = document.getElementById("videoCanvas");
    const ctx = canvas.getContext("2d");
    const video = document.createElement("video");

    let detector, poses = [];
    let shirtImg = new Image();
    let watchImg = new Image();
    let gogglesImg = new Image();

    // Load defaults
    shirtImg.src = "https://i.ibb.co/8mT3GgK/tshirt.png";
    watchImg.src = "https://i.ibb.co/MN6pXz8/watch.png";
    gogglesImg.src = "https://i.ibb.co/pWmC4Gn/goggles.png";

    // Upload handlers
    document.getElementById("shirtUpload").onchange = e => {
      shirtImg.src = URL.createObjectURL(e.target.files[0]);
    };
    document.getElementById("watchUpload").onchange = e => {
      watchImg.src = URL.createObjectURL(e.target.files[0]);
    };
    document.getElementById("gogglesUpload").onchange = e => {
      gogglesImg.src = URL.createObjectURL(e.target.files[0]);
    };

    // Screenshot
    document.getElementById("screenshotBtn").onclick = () => {
      const link = document.createElement("a");
      link.download = "screenshot.png";
      link.href = canvas.toDataURL();
      link.click();
    };

    async function init() {
      // Start camera
      const stream = await navigator.mediaDevices.getUserMedia({
        video: { width: 640, height: 480 }, audio: false
      });
      video.srcObject = stream;
      await video.play();

      // Load MoveNet
      detector = await poseDetection.createDetector(
        poseDetection.SupportedModels.MoveNet,
        { modelType: poseDetection.movenet.modelType.SINGLEPOSE_LIGHTNING }
      );

      renderLoop();
    }

    async function renderLoop() {
      ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

      if (detector) {
        poses = await detector.estimatePoses(video);
        if (poses.length > 0) {
          drawOverlays(poses[0].keypoints);
        }
      }
      requestAnimationFrame(renderLoop);
    }

    function drawOverlays(keypoints) {
      const get = name => keypoints.find(k => k.name === name);

      const leftShoulder = get("left_shoulder");
      const rightShoulder = get("right_shoulder");
      const leftHip = get("left_hip");
      const rightHip = get("right_hip");
      const leftWrist = get("left_wrist");
      const rightWrist = get("right_wrist");
      const leftEye = get("left_eye");
      const rightEye = get("right_eye");

      if (leftShoulder && rightShoulder && leftHip && rightHip) {
        const torsoWidth = Math.hypot(rightShoulder.x-leftShoulder.x, rightShoulder.y-leftShoulder.y);
        const torsoHeight = Math.hypot(leftHip.y-leftShoulder.y, rightHip.y-rightShoulder.y);
        ctx.drawImage(shirtImg,
          leftShoulder.x-20, leftShoulder.y-20,
          torsoWidth+40, torsoHeight+60
        );
      }

      if (leftWrist) {
        ctx.drawImage(watchImg, leftWrist.x-20, leftWrist.y-20, 40, 40);
      }
      if (rightWrist) {
        ctx.drawImage(watchImg, rightWrist.x-20, rightWrist.y-20, 40, 40);
      }

      if (leftEye && rightEye) {
        const eyeDist = Math.hypot(rightEye.x-leftEye.x, rightEye.y-leftEye.y);
        ctx.drawImage(gogglesImg, leftEye.x-30, leftEye.y-40, eyeDist+60, eyeDist+40);
      }
    }

    init();
  </script>
</body>
</html>
