pose.onResults((results) => {
  ctx.clearRect(0, 0, canvasElement.width, canvasElement.height);

  // Draw mirrored video frame
  // Because video element is mirrored via CSS, results.image is not mirrored
  // So we need to mirror the image on canvas too to match video.
  ctx.save();
  ctx.scale(-1, 1); // flip horizontally
  ctx.drawImage(results.image, -canvasElement.width, 0, canvasElement.width, canvasElement.height);
  ctx.restore();

  if (results.poseLandmarks && shirtLoaded) {
    const lm = results.poseLandmarks;
    const w = canvasElement.width;
    const h = canvasElement.height;

    // Flip pose landmarks horizontally to match mirrored video
    // Create flipped landmarks array
    const flippedLm = lm.map((point) => ({
      x: 1 - point.x,
      y: point.y,
      z: point.z,
      visibility: point.visibility,
    }));

    const leftShoulder = flippedLm[11];
    const rightShoulder = flippedLm[12];
    const leftHip = flippedLm[23];
    const rightHip = flippedLm[24];

    const shoulderCenterX = ((leftShoulder.x + rightShoulder.x) / 2) * w;
    const shoulderCenterY = ((leftShoulder.y + rightShoulder.y) / 2) * h;

    const hipCenterY = ((leftHip.y + rightHip.y) / 2) * h;
    const torsoHeight = hipCenterY - shoulderCenterY;

    const shoulderWidth = Math.abs(rightShoulder.x - leftShoulder.x) * w;

    const shirtWidth = shoulderWidth * 1.6;
    const shirtHeight = torsoHeight * 2.1;

    const shirtX = shoulderCenterX - shirtWidth / 2;
    const shirtY = shoulderCenterY + torsoHeight * 0.05;

    ctx.drawImage(shirt, shirtX, shirtY, shirtWidth, shirtHeight);
  }
});
