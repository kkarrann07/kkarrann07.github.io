<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>ChechIT ‚Äì AR Try-On (3D Overlays)</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: Arial, sans-serif; background: #f7f7f7; text-align: center; }
    header { background: #222; color: #fff; padding: 1rem; font-size: 1.4rem; font-weight: bold; }
    section { padding: 2rem; }
    iframe { width: 100%; height: 650px; border: none; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.2); transition: transform .3s; }
    iframe:hover { transform: translateY(-5px); }
    .upload-section { display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; align-items: start; }
    .file-input-wrapper { position: relative; }
    input[type="file"] { position: absolute; opacity: 0; width: 100%; height: 100%; cursor: pointer; }
    .file-input-label { display: flex; align-items: center; gap: 10px; padding: 15px 20px; background: #667eea; color: #fff; border-radius: 10px; cursor: pointer; transition: background .3s; user-select: none; }
    .file-input-label:hover { background: #546acb; }
    .static-shirt { perspective: 800px; width: 320px; margin: 1rem auto; user-select: none; }
    .rotator { width: 100%; height: 400px; border: 1px solid #ccc; border-radius: 12px; overflow: hidden; background: #fff; display: flex; align-items: center; justify-content: center; cursor: grab; transform-style: preserve-3d; }
    .rotator img { max-width: 100%; max-height: 100%; pointer-events: none; border-radius: 12px; backface-visibility: hidden; transition: transform .1s; }
    .rotator:active { cursor: grabbing; }
    .rotator-placeholder { color: #999; font-size: 1.2rem; text-align: center; }
    .ar-container { position: relative; width: 640px; height: 480px; margin: auto; border-radius: 12px; overflow: hidden; box-shadow: 0 8px 30px rgba(0,0,0,0.2); }
    video { position: absolute; top:0; left:0; width:100%; height:100%; transform: scaleX(-1); object-fit:cover; z-index:1; }
    #threejs-canvas { position:absolute; top:0; left:0; width:100%; height:100%; z-index:2; pointer-events:none; }
  </style>
</head>
<body>
  <header>üëó ChechIT ‚Äì AR Try-On</header>

  <section>
    <h2>üîç AI Fashion Search</h2>
    <p>Use our Hugging Face-powered model to search clothing with AI embeddings.</p>
    <iframe src="https://kkarrann07-Fashion.hf.space"></iframe>
  </section>

  <section>
    <h2>üñº Upload Overlays</h2>
    <p>Transparent PNG overlays for shirt, watch, goggles.</p>
    <div class="upload-section">
      <div class="file-input-wrapper">
        <input type="file" id="uploadShirt" accept="image/png" />
        <label for="uploadShirt" class="file-input-label">üëï Upload Shirt</label>
      </div>
      <div class="file-input-wrapper">
        <input type="file" id="uploadWatch" accept="image/png" />
        <label for="uploadWatch" class="file-input-label">‚åö Upload Watch</label>
      </div>
      <div class="file-input-wrapper">
        <input type="file" id="uploadGoggles" accept="image/png" />
        <label for="uploadGoggles" class="file-input-label">üï∂ Upload Goggles</label>
      </div>
    </div>
    <div class="static-shirt">
      <div class="rotator" id="rotator">
        <img id="staticPreview" src="" style="display:none" />
        <div class="rotator-placeholder" id="rotatorPlaceholder">üñº<br>3D Preview<br><small>Upload an overlay</small></div>
      </div>
    </div>
  </section>

  <section>
    <h2>üï∂ AR Try-On</h2>
    <p>Real-time camera with pose-based 3D overlays.</p>
    <div class="ar-container">
      <video id="video" autoplay playsinline muted></video>
      <canvas id="threejs-canvas"></canvas>
    </div>
  </section>

  <script src="https://cdn.jsdelivr.net/npm/three@0.155.0/build/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/pose@0.5/pose.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils@0.3/camera_utils.js"></script>
  <script>
    // Setup video
    const video = document.getElementById('video');
    navigator.mediaDevices.getUserMedia({video:{width:640,height:480}}).then(s=>video.srcObject=s);

    // Three.js init
    const canvas3 = document.getElementById('threejs-canvas'),
          renderer = new THREE.WebGLRenderer({canvas:canvas3,alpha:true}),
          scene = new THREE.Scene(),
          camera = new THREE.PerspectiveCamera(45,640/480,0.1,10);
    renderer.setSize(640,480);
    camera.position.set(0,1.5,2);
    scene.add(new THREE.AmbientLight(0xffffff,0.8));
    const dir = new THREE.DirectionalLight(0xffffff,0.6); dir.position.set(0,5,5); scene.add(dir);

    // Placeholder meshes
    const shirt = new THREE.Mesh(new THREE.PlaneGeometry(1,1.3), new THREE.MeshBasicMaterial({color:0x2196f3,transparent:true,opacity:0.8}));
    const goggles = new THREE.Mesh(new THREE.PlaneGeometry(0.6,0.2), new THREE.MeshBasicMaterial({color:0xffeb3b,transparent:true,opacity:0.8}));
    const watch = new THREE.Mesh(new THREE.PlaneGeometry(0.2,0.2), new THREE.MeshBasicMaterial({color:0x4caf50,transparent:true,opacity:0.8}));
    scene.add(shirt,goggles,watch);

    // Load images onto textures
    function applyTexture(img, mesh){
      const tex = new THREE.Texture(img); tex.needsUpdate=true;
      mesh.material.map=tex; mesh.material.color.set(0xffffff);
    }
    ['Shirt','Watch','Goggles'].forEach(type=>{
      const inp=document.getElementById('upload'+type),
            img=new Image(), mesh=(type==='Shirt'?shirt:type==='Watch'?watch:goggles);
      inp.onchange=e=>{
        const f=e.target.files[0],r=new FileReader();
        r.onload=ev=>{img.src=ev.target.result; applyTexture(img,mesh);};
        r.readAsDataURL(f);
      };
    });

    // MediaPipe Pose
    let latestPose=null;
    const pose = new Pose({locateFile:f=>`https://cdn.jsdelivr.net/npm/@mediapipe/pose@0.5/${f}`});
    pose.setOptions({modelComplexity:1,smoothLandmarks:true,minDetectionConfidence:0.5,minTrackingConfidence:0.5});
    pose.onResults(res=>latestPose=res.poseLandmarks);
    new Camera(video,{onFrame:async()=>await pose.send({image:video}),width:640,height:480}).start();

    // Convert normalized to World coords
    function toWorld(p){
      return new THREE.Vector3((1-p.x)-0.5,(p.y-0.5)*-1,p.z*2-1);
    }

    // Animation
    function animate(){
      requestAnimationFrame(animate);
      if(latestPose){
        const ls=toWorld(latestPose[11]), rs=toWorld(latestPose[12]),
              le=toWorld(latestPose[2]),  re=toWorld(latestPose[5]),
              rw=toWorld(latestPose[16]), lh=toWorld(latestPose[23]), rh=toWorld(latestPose[24]);
        // Shirt
        shirt.position.copy(ls.clone().add(rs).multiplyScalar(0.5)).setZ((ls.z+rs.z)/2);
        const w=ls.distanceTo(rs)*1.2, h=w*1.3;
        shirt.scale.set(w,h,1);
        shirt.rotation.set(0,0,Math.atan2(rs.y-ls.y,rs.x-ls.x));
        // Goggles
        goggles.position.copy(le.clone().add(re).multiplyScalar(0.5)).setZ((le.z+re.z)/2);
        const gw=le.distanceTo(re)*1.8;
        goggles.scale.set(gw,gw*0.4,1);
        // Watch
        watch.position.copy(rw).setZ(rw.z);
        watch.scale.set(0.2,0.2,1);
      }
      renderer.render(scene,camera);
    }
    animate();
  </script>
</body>
</html>
